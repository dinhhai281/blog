<!DOCTYPE html><html lang="vi"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.61 'Montserrat',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Montserrat',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.618rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.33471rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.21225rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.90825rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;color:inherit;font-family:'Montserrat',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.86558rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}ul{margin-left:1.61rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.61rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;font-size:0.85rem;line-height:1.61rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;font-size:1rem;line-height:1.61rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}blockquote{margin-left:1.61rem;margin-right:1.61rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.61rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.61rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.61rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.61rem;margin-bottom:calc(1.61rem / 2);margin-top:calc(1.61rem / 2);}li > ul{margin-left:1.61rem;margin-bottom:calc(1.61rem / 2);margin-top:calc(1.61rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.61rem / 2);}code{font-size:0.85rem;line-height:1.61rem;}kbd{font-size:0.85rem;line-height:1.61rem;}samp{font-size:0.85rem;line-height:1.61rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.07333rem;padding-right:1.07333rem;padding-top:0.805rem;padding-bottom:calc(0.805rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><style data-href="/blog/styles.4ded7ceae89755a8010a.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}*,:after,:before{box-sizing:border-box;border:0 solid #e2e8f0}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#a0aec0}input::placeholder,textarea::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}html{--bg-opacity:1;background-color:#f7fafc;background-color:rgba(247,250,252,var(--bg-opacity))}h4{font-size:1.5rem;--text-opacity:1;color:#b83280;color:rgba(184,50,128,var(--text-opacity));font-weight:500;margin-bottom:1rem}ul>li{list-style:disc;margin:1rem 2rem}code.language-text{padding-left:.5rem!important;padding-right:.5rem!important}p{margin-bottom:1rem}.tag{padding:.25rem .5rem;margin-right:.25rem;margin-bottom:.25rem;--bg-opacity:1;background-color:#d6bcfa;background-color:rgba(214,188,250,var(--bg-opacity));border-radius:.375rem;font-size:.75rem;font-weight:500;--ts-background-color:#007acc;--js-background-color:#f7df1e;--css-background-color:#1572b6;--react-background-color:#61dafb;--angular-background-color:#dd0031;--rxjs-background-color:#d81b60;--rust-background-color:#000;--nodejs-background-color:#393;--graphql-background-color:#e10098;--fb-background-color:#5d4f85}.tag-ts{background-color:var(--ts-background-color);color:#fff;color:rgba(255,255,255,var(--text-opacity))}.tag-js,.tag-ts{--text-opacity:1}.tag-js{background-color:var(--js-background-color);color:#000;color:rgba(0,0,0,var(--text-opacity))}.tag-css{background-color:var(--css-background-color);--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.tag-react{background-color:var(--react-background-color);--text-opacity:1;color:#000;color:rgba(0,0,0,var(--text-opacity))}.tag-angular{background-color:var(--angular-background-color)}.tag-angular,.tag-rxjs{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.tag-rxjs{background-color:var(--rxjs-background-color)}.tag-rust{background-color:var(--rust-background-color)}.tag-nodejs,.tag-rust{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.tag-nodejs{background-color:var(--nodejs-background-color)}.tag-graphql{background-color:var(--graphql-background-color)}.tag-fp,.tag-graphql{--text-opacity:1;color:#fff;color:rgba(255,255,255,var(--text-opacity))}.tag-fp{background-color:var(--fb-background-color)}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}.rounded-full{border-radius:9999px}.cursor-pointer{cursor:pointer}.flex{display:flex}.grid{display:grid}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-10{height:2.5rem}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-xl{font-size:1.25rem}.text-2xl{font-size:1.5rem}.text-3xl{font-size:1.875rem}.leading-10{line-height:2.5rem}.m-0{margin:0}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mr-3{margin-right:.75rem}.mt-6{margin-top:1.5rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mb-12{margin-bottom:3rem}.p-0{padding:0}.px-8{padding-left:2rem;padding-right:2rem}.pt-1{padding-top:.25rem}.pr-2{padding-right:.5rem}.pl-2{padding-left:.5rem}.pt-6{padding-top:1.5rem}.pb-24{padding-bottom:6rem}.text-pink-700{--text-opacity:1;color:#b83280;color:rgba(184,50,128,var(--text-opacity))}.text-opacity-75{--text-opacity:0.75}.underline{text-decoration:underline}.w-10{width:2.5rem}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}@media (min-width:640px){.sm\:mb-0{margin-bottom:0}}@media (min-width:768px){.md\:h-12{height:3rem}.md\:text-sm{font-size:.875rem}.md\:text-2xl{font-size:1.5rem}.md\:text-3xl{font-size:1.875rem}.md\:text-4xl{font-size:2.25rem}.md\:mb-10{margin-bottom:2.5rem}.md\:px-16{padding-left:4rem;padding-right:4rem}.md\:pt-10{padding-top:2.5rem}.md\:w-12{width:3rem}}@media (min-width:1024px){.lg\:text-4xl{font-size:2.25rem}.lg\:text-5xl{font-size:3rem}.lg\:mb-12{margin-bottom:3rem}.lg\:px-32{padding-left:8rem;padding-right:8rem}.lg\:pt-12{padding-top:3rem}}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.10"/><title data-react-helmet="true">Một chút ngẫu hứng với Angular - First Class Observable Pattern | Góc Sáng</title><meta data-react-helmet="true" name="description" content="Personal blog by Hai Nguyen"/><meta data-react-helmet="true" name="keywords" content="Blog,React,Angular,Javascript,Typescript,Functional Programming"/><meta data-react-helmet="true" property="og:title" content="Một chút ngẫu hứng với Angular - First Class Observable Pattern"/><meta data-react-helmet="true" property="og:type" content="website"/><link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/blog/webpack-runtime-d6f6abd63bb113a94911.js"/><link as="script" rel="preload" href="/blog/framework-d9cf0f47b747b267fae2.js"/><link as="script" rel="preload" href="/blog/styles-1211262dd08146354a2f.js"/><link as="script" rel="preload" href="/blog/app-f7307a6ac13ec036d92e.js"/><link as="script" rel="preload" href="/blog/022d3153bf09c36cd784dcdb36ffbd187f9c96d7-56414ee62f29fb42ac66.js"/><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-tsx-da91de74ceb71c240a8a.js"/><link as="fetch" rel="preload" href="/blog/page-data/vi/first-class-observable-angular/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="container pt-6 md:pt-10 lg:pt-12 px-8 md:px-16 lg:px-32 mx-auto"><header class="flex justify-between items-center mb-6 md:mb-10 lg:mb-12"><h1 class="text-pink-700 text-3xl md:text-4xl lg:text-5xl font-bold leading-10"><a role="link" href="/blog/vi/">Góc Sáng</a></h1></header><main role="main"><div class="pb-24"><header><h1 data-testid="title" class="mb-12 text-2xl md:text-3xl lg:text-4xl text-pink-700 font-semibold">Một chút ngẫu hứng với Angular - First Class Observable Pattern</h1><div class="mb-8 mx-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:30%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABQElEQVQY02NYrtjNyAAEr0V7lU/I9K7bJ9W77pRQdyADFMyU7WBABpnaHYxAzIANwMX/M0zkmKLSfWGj2qz/x8R6/n3nm/X/Gn/PQrhCrXaODK12niztTiYkMeY0zRbGTK0OLiDmQTF5i0yXzSKlyf+nqvbMnSPTIf2Oqzdhh1h3pademxlIHmiQKdB2VyCWAmJxkCFZ2h28QEtAfBMg1gGyGeEGHpbs1r4pOOH/fZ4eJ5hYrH5HVIZWRyHUQEOgJgsgFgZiNyCWB2IVoCHSQFoOItfOBdZ4W7AX7I13gn2zXvL3XnzD3mN5QLzHcYZyz90azS5TkFyRVhc70FUMQAPYgZq5gTQbkJYBYlYgFgFiCZC6Av1JDAyfxfqgAdnE8Ea0b+Ib3r4fVwV6HmyQ7ckDCb9l72FECXA8IFWjiQEAuTx4QioONh0AAAAASUVORK5CYII=" alt="featured-img" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/blog/static/c74ac8947b9e5dc496e8909256ceb548/5ca18/rxjs-featured.png 270w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/13528/rxjs-featured.png 540w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/05d05/rxjs-featured.png 1080w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/ba0d8/rxjs-featured.png 1620w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/85b69/rxjs-featured.png 1838w" sizes="(max-width: 1080px) 100vw, 1080px" /><img loading="lazy" sizes="(max-width: 1080px) 100vw, 1080px" srcset="/blog/static/c74ac8947b9e5dc496e8909256ceb548/5ca18/rxjs-featured.png 270w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/13528/rxjs-featured.png 540w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/05d05/rxjs-featured.png 1080w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/ba0d8/rxjs-featured.png 1620w,
/blog/static/c74ac8947b9e5dc496e8909256ceb548/85b69/rxjs-featured.png 1838w" src="/blog/static/c74ac8947b9e5dc496e8909256ceb548/05d05/rxjs-featured.png" alt="featured-img" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></header><div data-testid="post-content"><p>Reactive eXtensions for JavaScript là vũ khí tối thượng với bất kỳ ai code JavaScript đặc biệt là những ai đau khổ với Angular như mình. Trong những ngày tháng đó thì mình cũng tìm ra một cách để enjoy Angular đó là dùng RxJS cho mọi thứ biến bản thân thành một Pure Reactive Programmer. Bài viết này sẽ viết về cách mình sử dụng rxjs cho phần lớn các trường hợp thường gặp phải khi làm việc với Angular, cái mà mình tự gọi là <code class="language-text">First Class Observable Pattern</code>.</p>
<p>⚠️ <strong>Một số thuật ngữ dùng trong này đều không chính thức và có thể không chính xác về mặt học thuật.</strong></p>
<p>Ý tưởng chính ở đây là dùng <code class="language-text">Observable</code> cho tất cả mọi thứ. Dữ liệu, event, side effect,... tất cả đều được thể hiện dưới dạng <code class="language-text">Observable</code>. Mục đích của việc này là tất cả mọi thứ đều là stream thì có thể sử dụng các operator của <code class="language-text">RxJS</code> để thực hiện các logic trong code. Điều này rất cần thiết khi cần làm những thứ như là input và một input thì giá trị ở input khác cũng phải đổi theo và có thể trong đó còn vài yếu tố khác ảnh hưởng tới luồng thay đổi đó.</p>
<h4>Observable - Vũ khí tối thượng</h4>
<p>Ví dụ bạn có có 2 biến <code class="language-text">x</code> và <code class="language-text">y</code> là <code class="language-text">number</code>. Nếu bạn muốn <code class="language-text">z</code> = <code class="language-text">x</code> + <code class="language-text">y</code> thì bạn sẽ làm như thế nào?</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> z <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span></code></pre></div>
<p>Nếu bạn làm giống như đoạn code trên thì có thể nói là bạn vừa đúng vừa sai. Bạn đúng vì tại thời điểm phép gán được thực hiện nhưng nếu sau đó bạn gán <code class="language-text">x = 1</code> thì sao? Bạn thấy đó nếu giá trị của <code class="language-text">x</code> thay đổi thì ngay lập tức <code class="language-text">z</code> đã không còn bằng <code class="language-text">x + y</code>. Bạn sẽ cần phải lặp lại dòng code <code class="language-text">let z = x + y</code>.</p>
<p>Để chắc chắn <code class="language-text">z</code> luôn luôn bằng <code class="language-text">x + y</code> thì hãy tưởng tượng <code class="language-text">x</code> và <code class="language-text">y</code> là các stream <code class="language-text">number</code> giá trị của chúng sẽ thay đổi theo thời gian, còn <code class="language-text">z</code> là một stream tổng của <code class="language-text">x</code> và <code class="language-text">y</code> (giá trị của z sẽ là tổng của x và y tại thời điểm t). Điều này có nghia là mỗi khi x hoặc y thay đổi giá trị thì giá trị của z sẽ được tính lại.</p>
<p>Hy vọng bạn hiểu vấn đề trên, đó là ý tưởng của <code class="language-text">Reactive Programming</code>. Vậy để làm việc trên thay vì biểu diển x và y là 2 <code class="language-text">number</code> và gán <code class="language-text">z</code> bằng <code class="language-text">x + y</code> ở một dòng code nào đó thì hãy cân nhắc làm như thế này.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> x$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> y$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> z$ <span class="token operator">=</span> <span class="token function">combineLatest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x$<span class="token punctuation">,</span> y$<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Nếu muốn thay đổi giá trị của x và y</span>
x$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
y$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Tới đây có thể nhiều người sẽ nghĩ rằng việc trên chỉ là phức tạp hoá mọi thứ, thật ra cũng đúng nhưng mà đôi khi phải chấp nhận đánh đổi cái này để có được cái khác thôi. Hãy tưởng tượng <code class="language-text">Observable</code> là một cái hộp được thiết kế để dễ dàng sắp xếp và di chuyển, nếu bạn bỏ hết tất cả đồ đạc trong nhà vô đó thì mọi thứ trọng nhà bạn đều có thể được sắp xếp gọn gàng, bạn sẽ làm được được những việc mà trước đó không thể nào làm được chẳng hạn như đặt một cái bàn phím nằm trên một cây bút 🤔. Thay vì bất khả thi thì bây giờ chỉ cần bỏ mọi thứ vô hộp là được.</p>
<p>Nhưng mà khó khăn một cái là bây giờ muốn dùng cái gì thì trước hết bạn phải lấy cái hộp đựng đồ vật đó rồi mở hộp ra.</p>
<p><em>Thật ra mình cũng muốn giải thích cái lý thuyết trên bằng Functional Programming nhưng mà tự thấy trình chưa đủ để giải thích nên mới có câu chuyện cái hộp, bàn phím và cây bút ở trên</em> 😥</p>
<p>Quay lại với code thì mình muốn bỏ tất cả mọi thứ từ data đến logic vào trong <code class="language-text">Observable</code> và dùng các operator mà <code class="language-text">rxjs</code> cung cấp để thao tác trên những <code class="language-text">Observable</code> đó. Với số lượng <code class="language-text">operator</code> cực khủng mà <code class="language-text">rxjs</code> cung cấp thì điều này vô cùng khả thi. Ví dụ trên là cộng 2 số trong thế giới của <code class="language-text">Observable</code> đó.</p>
<h4>Một số ví dụ để làm quen</h4>
<p><code class="language-text">Reactive Programming</code> hay hẹp hơn là <code class="language-text">rxjs</code> không phải quá khó để dùng, mọi thứ bạn làm được với cách code thông thường bạn đều có thể làm được điều tương tự với các operator của <code class="language-text">rxjs</code>. Phần này mình sẽ đưa ra một số ví dụ để những ai mới biết đến <code class="language-text">rxjs</code> có thể làm quen với cách suy nghĩ <strong>Everything is stream</strong> nhé.</p>
<p><em>Để dễ hiểu thì các mình sẽ dùng <code class="language-text">BehaviorSubject</code> để tạo các local stream, trong thực thế bạn có thể tạo ra một <code class="language-text">Observable</code> từ bất cứ thứ gì.</em></p>
<p><strong>Filter một mảng theo điều kiện</strong></p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> NumberType <span class="token operator">=</span> <span class="token string">'ODD'</span> <span class="token operator">|</span> <span class="token string">'EVEN'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> selectedNumberType$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span>NumberType<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'ODD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numbers$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> filteredNumbersA$ <span class="token operator">=</span> <span class="token function">combineLatest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  numbers$<span class="token punctuation">,</span>
  selectedNumberType$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">numberType</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>
      value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token punctuation">(</span>numberType <span class="token operator">===</span> <span class="token string">'ODD'</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>numbers<span class="token punctuation">,</span> filterFn<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>filterFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Nếu bạn muốn kết quả chỉ thay đổi khi loại số được chọn thay đổi.</span>
<span class="token keyword">const</span> filteredNumbersB$ <span class="token operator">=</span> selectedNumberType$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">numberType</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>
    value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token punctuation">(</span>numberType <span class="token operator">===</span> <span class="token string">'ODD'</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">withLatestFrom</span><span class="token punctuation">(</span>numbers$<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>filterFn<span class="token punctuation">,</span> numbers<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> numbers<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>filterFn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [1, 3]</span>
<span class="token comment">// [2, 4]</span>
<span class="token comment">// [2]</span>
<span class="token comment">// [1]</span>
filteredNumbersA$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [1, 3]</span>
<span class="token comment">// [2, 4]</span>
<span class="token comment">// [1]</span>
filteredNumbersB$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

selectedNumberType$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'EVEN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
numbers$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selectedNumberType$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'ODD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Trong ví dụ trên mình đã lấy ra các số chẵn hoặc lẽ tuỳ theo <code class="language-text">selectedNumberType</code> đang là <code class="language-text">EVEN</code> hay <code class="language-text">ODD</code>. Cụ thể là các giá trị được emit từ <code class="language-text">selectedNumberType$</code> sẽ được map thành một <code class="language-text">function</code> dùng để lấy số chẳn hay lẻ để sử dụng trong method <code class="language-text">filter</code> của array. Bây giờ bạn hãy suy nghĩ cách để làm điều tương tự như <code class="language-text">filteredNumbersA$</code> (kết quả filter được thay đổi mỗi khi mảng number và điều kiện filter thay đổi) và  <code class="language-text">filteredNumbersB$</code> (kết quả filter được thay đổi chỉ khi điều kiện filter thay đổi) xem có đơn giản không nhé.</p>
<p>Nếu như code bình thường bạn làm được kết quả tương tự một cách đơn giản trên nếu chẳng cần quan tâm phải update lại kết quả nếu như các biến số của bạn thay đổi. Tuy nhiên khi sự thay đổi trở nên cần thiết bạn vẫn sẽ làm được thôi nhưng mà rất có thể là nó sẽ vô cùng phức tạp và không ai hiểu nổi ngoài bạn (mình đang nghĩ tới việc tạo một class với vài cái setter chứ thiệt bản thân mình cũng chả biết phải code sao cho hay để làm chuyện tương tự).</p>
<p><strong>Toogle</strong></p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> buttonClick$ <span class="token operator">=</span> <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> isShow$ <span class="token operator">=</span> buttonClick$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">scan</span><span class="token punctuation">(</span><span class="token parameter">acc</span> <span class="token operator">=></span> <span class="token operator">!</span>acc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

isShow$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// click -> true</span>
<span class="token comment">// click -> false</span>
<span class="token comment">// click -> true</span>
<span class="token comment">// click -> false</span></code></pre></div>
<p><strong>Autocomplete with a list of items</strong></p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">fetchAnimals</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'mouse'</span><span class="token punctuation">,</span> <span class="token string">'frog'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchFruits</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'banana'</span><span class="token punctuation">,</span> <span class="token string">'durian'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'pineapple'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> searchTerm$ <span class="token operator">=</span> <span class="token function">fromEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> itemType$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span><span class="token string">'ANIMAL'</span> <span class="token operator">|</span> <span class="token string">'FRUIT'</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">makeFilteredItems</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token parameter">term$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">,</span>
  items$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token operator">=></span> items$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">items</span> <span class="token operator">=></span> term$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">term</span> <span class="token operator">=></span> items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> item<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mỗi khi item type thay đổi thì sau 2s sẽ tạo ra array các item </span>
<span class="token comment">// array này có thể được filter theo giá trị được nhập vào input</span>
<span class="token comment">// Nếu nhập input trước 2s sẽ không tính</span>
<span class="token comment">// khi đổi type thì sẽ filter lại từ đâu (input không bị xoá chỉ là không có hiệu lực thôi)</span>
<span class="token keyword">const</span> result$ <span class="token operator">=</span> itemType$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">itemType</span> <span class="token operator">=></span> <span class="token function">makeFilteredItems</span><span class="token punctuation">(</span>
    searchTerm$<span class="token punctuation">,</span>
    itemType <span class="token operator">===</span> <span class="token string">'ANIMAL'</span> <span class="token operator">?</span> <span class="token function">fetchAnimals</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">fetchFruits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// --*-- ANIMAL --*--</span>
<span class="token comment">// ['dog', 'cat', 'mouse', 'frog']</span>
<span class="token comment">// ['dog', 'mouse', 'frog']</span>
<span class="token comment">// ['dog', 'frog']</span>
<span class="token comment">// ['dog', 'mouse', 'frog']</span>
<span class="token comment">// ['cat']</span>

<span class="token comment">// --*-- FRUIT --*--</span>
<span class="token comment">// ['banana', 'durian', 'apple', 'pineapple'] (t)</span>
<span class="token comment">// ['banana', 'durian', 'apple', 'pineapple'] ( )</span>
<span class="token comment">// ['apple', 'pineapple'] (ap)</span>
<span class="token comment">// ['banana', 'durian', 'apple', 'pineapple'] (a)</span>
<span class="token comment">// ['banana', 'durian', 'apple', 'pineapple'] ( )</span>
<span class="token comment">// ['banana', 'durian', 'apple', 'pineapple'] (a)</span>
<span class="token comment">// ['banana' 'durian'] (an)</span>
result$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>

itemType$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'ANIMAL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// input: (sau 2s) o---og---o---t</span>
itemType$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'FRUIT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// input (đang là t từ lần nhập trước): sau (2s) -- --ap--a-- --a--an</span></code></pre></div>
<p>Trên đây là một số ví dụ sử dụng <code class="language-text">rxjs</code> để thực hiện một số việc, về cơ bản bất cứ thứ gì bạn cũng có thể nhét nó vào trong 1 <code class="language-text">Observable</code> và nếu tất cả mọi thứ đều là <code class="language-text">Observable</code> thì tất cả những logic, những tính toán mà bạn thực hiện hằng ngày đều sẽ là sự kết hợp của các observable và các operator.</p>
<h4>Angular First Class Observable</h4>
<p>Nếu như bạn có thể thay đổi mindset theo hướng <code class="language-text">Reactive Programming</code>, biến đổi tất cả mọi thứ có trong một component thành dạng <code class="language-text">Observable</code> thì đó chính là pattern mà mính gọi là <code class="language-text">Angular First Class Observable</code>. Nghe có vẻ mơ hồ nên mình sẽ đưa ra một số nguyên tắc sau:</p>
<ul>
<li>Tất cả các property đều phải là <code class="language-text">Observable</code>.</li>
<li>Sử dụng <code class="language-text">BehaviorSubject</code> cho các state của component.</li>
<li>Nếu cần handle một event từ template, đừng tạo handler method hãy dùng <code class="language-text">Subject</code> để thể hiển một stream các event cần handle và subscribe vào subject đó.</li>
<li>Chuyển tất cả <code class="language-text">@Input</code> về dạng <code class="language-text">Observable</code>.</li>
</ul>
<p>Để đơn giản thì mình hãy xem qua ví dụ này nhé.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">'app-counter'</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div>{{ $count | async }}&lt;div>
    &lt;button (click)="upBtnClick$.next()">UP&lt;/button>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CounterComponent</span> <span class="token keyword">implements</span> <span class="token class-name">OnInit</span><span class="token punctuation">,</span> OnDestroy <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">get</span> <span class="token function">startValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_startValue$<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">startValue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_startValue$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  count$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span>
  upBtnClick$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> _startValue$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReplaySubject</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> _step$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BehaviorSubject</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> _unsubscribe$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token function-variable function">_initData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_startValue$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">startValue</span> <span class="token operator">=></span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">withLatest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_step$<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>value<span class="token punctuation">,</span> step<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> value <span class="token operator">*</span> step <span class="token operator">+</span> startValue<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function-variable function">_initEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_upBtnClickEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">ngOnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_unsubscribe$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_unsubscribe$<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token function-variable function">_upBtnClickEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>upBtnClick$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_step$<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token punctuation">,</span> step<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>_step$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>step <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_unsubscribe$<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Component Counter trong ví dụ trên sẽ hiện một số tăng liên tục từ <code class="language-text">startValue</code> được truyền từ input, mỗi lần <code class="language-text">startValue</code> thay đổi nó sẽ đếm lại từ giá trị <code class="language-text">startValue</code> mới đó. Nếu click vào nút <code class="language-text">UP</code> thì giá trị đếm tăng lên mỗi giây sẽ thêm 1. Bạn có thể thấy rằng tất cả mọi thứ mình sử dụng đều là <code class="language-text">Observable</code>:</p>
<ul>
<li><code class="language-text">input starValue</code> đã bị đổi thành <code class="language-text">_startValue$</code> bằng getter và setter.</li>
<li>Giá trị đếm hiển thị trên UI và logic để tăng giá trị đó lên sau mỗi giây sẽ được thể hiện qua <code class="language-text">count$</code>.</li>
<li>Xử lý event click cũng được thực hiện thông qua <code class="language-text">upBtnClick</code>.</li>
<li>Dùng <code class="language-text">_step$</code> để lưu lại state.</li>
<li>Logic update lại state mỗi khi click cũng là một observable và được tạo ra từ <code class="language-text">_upBtnClickEffect()</code>.</li>
</ul>
<p>Đơn giản thế thôi, hầu như mọi thứ đều có thể được xử lý dưới dạng <code class="language-text">Observable</code>, lúc đó chúng ta có thể tận dụng sức mạnh mà <code class="language-text">Observable</code> mang lại để thực hiện những logic vô cùng phức tạp nhưng code theo phong cách declarative rất dễ hiểu.</p>
<p>Nói dông dài thì <code class="language-text">Angular First Class Observable</code>, ví dụ trên có lẽ là đủ để các bạn có được ý tưởng để chuyển mọi thứ trong một component thành <code class="language-text">Observable</code>. Tuy nhiên chắc nhiều bạn sẽ thấy rằng quá nhiều boilerplate code. Chúng ta có thể sử dụng <code class="language-text">decorator</code> cải thiện việc này.</p>
<h4>ObservableBinding Decorator</h4>
<p>Trong ví dụ thì <code class="language-text">Input</code> nào các bạn cũng có thể dùng cách này để thực hiện chuyển thành observable. Vậy để đỡ phải code lặp đi lặp lại thì hãy tạo một decorator cho việc này.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ReplaySubject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> ObservableBinding<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>map<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token builtin">symbol</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> subjectSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token operator">:</span> object<span class="token punctuation">,</span> key<span class="token operator">:</span> PropertyKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">definedProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReplaySubject</span><span class="token operator">&lt;</span><span class="token constant">K</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token builtin">symbol</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>map <span class="token operator">?</span> <span class="token function">map</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReplaySubject</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token builtin">symbol</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>subjectSymbol<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token builtin">symbol</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Sau đó thay vì đống get, set trên thì chỉ cần</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">@<span class="token function">ObservableBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span> url$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>

@<span class="token function">ObservableBiding</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
@<span class="token function">Input</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">)</span> count$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span></code></pre></div>
<p>Cơ bản ý tưởng chỉ có vậy, nếu bạn thích <code class="language-text">rxjs</code> như mình và thích dùng nó nhiều nhất có thể thì đây là một hướng đi mà bạn có thể cân nhắc. Nếu <code class="language-text">rxjs</code> là lý do bạn code Angular như mình thì còn chờ gì nữa mà không lên github cho <code class="language-text">rxjs</code> một star sẵn tiện unstar Angular luôn 😬</p>
<h4>Hy vọng bạn thấy bài viết này bổ ích 💕</h4></div></div></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/vi/first-class-observable-angular";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-f7307a6ac13ec036d92e.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-0e7509a3429803f7697c.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-377f0500fd9be3c1a84c.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-da91de74ceb71c240a8a.js"]};/*]]>*/</script><script src="/blog/component---src-templates-blog-post-tsx-da91de74ceb71c240a8a.js" async=""></script><script src="/blog/022d3153bf09c36cd784dcdb36ffbd187f9c96d7-56414ee62f29fb42ac66.js" async=""></script><script src="/blog/app-f7307a6ac13ec036d92e.js" async=""></script><script src="/blog/styles-1211262dd08146354a2f.js" async=""></script><script src="/blog/framework-d9cf0f47b747b267fae2.js" async=""></script><script src="/blog/webpack-runtime-d6f6abd63bb113a94911.js" async=""></script></body></html>